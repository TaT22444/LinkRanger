# Wink Admin Console 使用ガイド

## 概要
Wink Admin Consoleは、LinkRangerアプリの運営者向け管理画面です。お知らせの作成・配信、統計情報の確認、システム管理操作を行うことができます。

## アクセス方法

### Web管理画面
- **URL**: https://linkranger-b096e.web.app/admin
- **認証**: Googleアカウントでのサインインが必要
- **権限**: 管理者権限を持つメールアドレスのみアクセス可能

### 管理者メールアドレス
現在登録されている管理者メールアドレス：
- `tatsu0823takasago@icloud.com`

新しい管理者を追加する場合は、`public/admin.html`の`ADMIN_EMAILS`配列に追加してください。

## 主な機能

### 1. 📊 統計情報
- **総ユーザー数**: 登録済みユーザーの総数
- **アクティブお知らせ**: 現在公開中のお知らせ数
- **更新ボタン**: 最新の統計情報を取得

### 2. 📢 お知らせ管理

#### 新規お知らせ作成
1. **「➕ 新規作成」**ボタンをクリック
2. 以下の項目を入力：
   - **タイトル**: お知らせのタイトル
   - **内容**: お知らせの詳細内容
   - **優先度**: 
     - `低`: 一般的な情報
     - `中`: 通常のお知らせ
     - `高`: 重要・緊急（自動でプッシュ通知送信）
   - **対象ユーザー**:
     - `全ユーザー`: すべてのユーザー
     - `無料プランのみ`: 無料プランユーザーのみ
     - `有料プランのみ`: 有料プランユーザーのみ
3. **「📤 お知らせを作成」**をクリック

#### お知らせ一覧管理
1. **「📋 一覧表示」**ボタンをクリック
2. 各お知らせに対して以下の操作が可能：
   - **📱 通知送信**: 個別にプッシュ通知を送信
   - **🚫 無効化 / ✅ 有効化**: お知らせの表示/非表示を切り替え

### 3. ⚙️ システム管理
- **🗑️ キャッシュクリア**: システムキャッシュをクリア
- **🏥 システム状態確認**: システムの動作状況を確認（今後実装予定）

## コマンドライン操作（代替方法）

Web管理画面が利用できない場合、以下のコマンドでも操作可能です：

### 環境準備
```bash
# Firebase CLIログイン
firebase login

# プロジェクト設定
firebase use linkranger-b096e
```

### お知らせ作成
```bash
# 基本的なお知らせ
npm run announcement:create "タイトル" "内容" "medium" "all"

# 重要なお知らせ（有料ユーザーのみ）
npm run announcement:create "メンテナンス予告" "システムメンテナンスを実施します" "high" "plus"
```

### プッシュ通知送信
```bash
# 作成されたお知らせIDを使用
npm run announcement:notify "お知らせID"
```

## お知らせの種類と使い分け

### 優先度による違い
- **低 (low)**: アプリ内お知らせのみ
- **中 (medium)**: アプリ内お知らせのみ
- **高 (high)**: アプリ内お知らせ + 自動プッシュ通知送信

### 対象ユーザーによる分類
- **全ユーザー**: すべてのユーザーに配信
- **無料プランのみ**: 無料プランユーザーに限定（有料プラン案内など）
- **有料プランのみ**: 有料プランユーザーに限定（プレミアム機能案内など）

## 通知システムの仕組み

1. **お知らせ作成**: Firestoreの`announcements`コレクションに保存
2. **アプリ内表示**: ユーザーがアプリを開くと自動で取得・表示
3. **プッシュ通知**: FCM（Firebase Cloud Messaging）経由で配信
4. **既読管理**: ユーザーごとの既読状態を管理

## セキュリティ

- **認証**: Firebase Authenticationによるログイン認証
- **認可**: 管理者メールアドレスによる権限制御
- **Cloud Functions**: サーバーサイドでの通知送信処理

## トラブルシューティング

### サインインできない
- 管理者権限のあるGoogleアカウントでサインインしているか確認
- ブラウザのキャッシュをクリアして再試行

### お知らせが表示されない
- お知らせが「有効」状態になっているか確認
- `publishedAt`の日時が現在時刻以前になっているか確認

### プッシュ通知が送信されない
- ユーザーがFCMトークンを登録しているか確認
- APNs証明書が正しく設定されているか確認（iOS）

## 開発者向け情報

### ファイル構成
- **管理画面**: `/public/admin.html`
- **お知らせサービス**: `/src/services/announcementService.ts`
- **Cloud Functions**: `/functions/src/index.ts`
- **作成スクリプト**: `/scripts/create-announcement.js`
- **通知スクリプト**: `/scripts/send-notification.js`

### 管理者の追加
1. `public/admin.html`の`ADMIN_EMAILS`配列に新しいメールアドレスを追加
2. Firebase Hostingに再デプロイ
```bash
firebase deploy --only hosting
```

## 運用時の注意点

1. **重要なお知らせ**: 事前にテストアカウントで動作確認を実施
2. **メンテナンス通知**: 十分な余裕を持って事前通知
3. **通知頻度**: ユーザーの迷惑にならないよう配信頻度に注意
4. **内容確認**: 誤字脱字、リンクの正確性を事前確認

---

## 更新履歴
- 2025-08-27: 初版作成
- Web管理画面の実装完了
- お知らせ作成・管理機能の実装
- プッシュ通知システムの統合